<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è - –õ—ñ–∫–∞—Ä–Ω—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .login-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            animation: slideIn 0.3s;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #e74c3c;
        }

        .user-type-selection {
            margin: 20px 0;
        }

        .user-type-btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .patient-btn {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .employee-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .user-type-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Employee Login Form */
        .employee-login {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        /* Main Application */
        .app-container {
            display: none;
        }

        .app-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .menu-week {
            max-height: 400px;
            overflow-y: auto;
        }

        .day-menu {
            margin-bottom: 20px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
        }

        .day-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meal-type {
            margin: 10px 0;
            padding: 8px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 5px;
            border-left: 3px solid #3498db;
        }

        .meal-type h4 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .meal-items {
            font-size: 0.85em;
            color: #555;
        }

        .meal-option {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #ecf0f1;
            transition: all 0.3s ease;
        }

        .meal-option:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .meal-option.selected {
            border-color: #27ae60;
            background: rgba(46, 204, 113, 0.1);
        }

        .meal-option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .meal-option-title {
            font-weight: bold;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .meal-option-price {
            font-size: 1.3em;
            font-weight: bold;
            color: #e74c3c;
        }

        .meal-option-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-style: italic;
        }

        .select-meal-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-meal-btn:hover {
            background: linear-gradient(45deg, #2980b9, #1f5582);
            transform: translateY(-2px);
        }

        .select-meal-btn.selected {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .order-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            grid-column: 1 / -1;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .employee-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .order-summary {
            background: rgba(46, 204, 113, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .total-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
            text-align: center;
            margin: 15px 0;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .time-warning {
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            color: #c0392b;
            font-weight: bold;
            text-align: center;
        }

        .success-message {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            color: #229954;
            font-weight: bold;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 10px 20px;
            background: #ecf0f1;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .admin-tab.active {
            background: #3498db;
            color: white;
        }

        .admin-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        tbody tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        /* Export Button */
        .export-btn {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        /* Edit Modal */
        .edit-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .edit-modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Menu Editor */
        .menu-editor-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .menu-editor-item h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .meal-editor {
            display: grid;
            gap: 10px;
            margin: 10px 0;
        }

        .meal-editor input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .day-selector {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .day-btn {
            padding: 10px;
            background: #ecf0f1;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .day-btn.active {
            background: #3498db;
            color: white;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row,
            .employee-form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .day-selector {
                grid-template-columns: 1fr;
            }

            .app-header {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .user-info {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
        }
    
.password-wrapper {
    position: relative;
}
.password-wrapper input {
    padding-right: 40px;
}
.password-toggle {
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
    color: #888;
}
.password-toggle:focus {
    outline: none;
}

</style>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcome-screen">
            <div class="header">
                <h1>üè• –°–∏—Å—Ç–µ–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h1>
                <button class="login-btn" onclick="openLoginModal()">–£–≤—ñ–π—Ç–∏</button>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeLoginModal()">&times;</span>
                <h2>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
                
                <!-- User Type Selection -->
                <div id="user-type-selection" class="user-type-selection">
                    <button class="user-type-btn patient-btn" onclick="selectUserType('patient')">
                        üë§ –ü–∞—Ü—ñ—î–Ω—Ç
                    </button>
                    <button class="user-type-btn employee-btn" onclick="selectUserType('employee')">
                        üë®‚Äç‚öïÔ∏è –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫
                    </button>
                </div>

                <!-- Employee Login Form -->
                <div id="employee-login" class="employee-login">
                    <h3>–í—Ö—ñ–¥ –¥–ª—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</h3>
                    <div class="form-group">
                        <label for="employee-phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:</label>
                        <input type="tel" id="employee-phone" placeholder="+380XXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="employee-password">–ü–∞—Ä–æ–ª—å:</label>
                        <div class="password-wrapper">
                            <input type="password" id="employee-password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                            <button type="button" class="password-toggle" onclick="togglePassword('employee-password', this)">üëÅ</button>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="loginEmployee()">–£–≤—ñ–π—Ç–∏</button>
                        <button class="btn btn-warning" onclick="backToUserSelection()">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="app-container" class="app-container">
            <div class="app-header">
                <div>
                    <h1>üè• –°–∏—Å—Ç–µ–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h1>
                    <div id="current-time"></div>
                </div>
                <div class="user-info">
                    <span id="user-type-display"></span>
                    <button class="logout-btn" onclick="logout()">–í–∏–π—Ç–∏</button>
                </div>
            </div>

            <div class="main-content">
                <div class="card">
                    <h3>üìã –¢–∏–∂–Ω–µ–≤–µ –º–µ–Ω—é</h3>
                    <div id="weekly-menu" class="menu-week">
                        <!-- Weekly menu will be dynamically generated -->
                    </div>
                </div>

                <div class="card">
                    <h3>üìä –í–∞—à—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
                    <div id="order-history">
                        <div style="text-align: center; color: #7f8c8d; padding: 20px;">
                            –ü–æ–∫–∏ —â–æ –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn btn-warning" onclick="clearOrderHistory()" style="font-size: 14px; padding: 8px 16px;">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é
                        </button>
                    </div>
                </div>
            </div>

            <!-- Patient Order Form -->
            <div id="patient-order-form" class="order-form hidden">
                <h3>üõí –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–ü–∞—Ü—ñ—î–Ω—Ç)</h3>
                <div id="time-warning" class="time-warning" style="display: none;">
                    ‚ö†Ô∏è –£–≤–∞–≥–∞! –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –¥–æ 14:00 —Å—å–æ–≥–æ–¥–Ω—ñ!
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="patient-department">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è:</label>
                        <select id="patient-department">
                            <option value="">–û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-room">–ü–∞–ª–∞—Ç–∞:</label>
                        <input type="text" id="patient-room" placeholder="–ù–æ–º–µ—Ä –ø–∞–ª–∞—Ç–∏">
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-name">–ü–∞—Ü—ñ—î–Ω—Ç:</label>
                        <input type="text" id="patient-name" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü.–ë.">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="patient-order-date">–î–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</label>
                        <input type="date" id="patient-order-date">
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-diet-type">–¢–∏–ø –¥—ñ—î—Ç–∏:</label>
                        <select id="patient-diet-type">
                            <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞</option>
                            <option value="diet-1">–î—ñ—î—Ç–∞ ‚Ññ1</option>
                            <option value="diet-5">–î—ñ—î—Ç–∞ ‚Ññ5</option>
                            <option value="diet-9">–î—ñ—î—Ç–∞ ‚Ññ9</option>
                            <option value="diet-15">–î—ñ—î—Ç–∞ ‚Ññ15</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-days-count">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤:</label>
                        <input type="number" id="patient-days-count" min="1" max="7" value="1">
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <h4>–í–∞—Ä—ñ–∞–Ω—Ç–∏ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è:</h4>
                    
                    <div class="meal-option" id="full-meal-option">
                        <div class="meal-option-header">
                            <div class="meal-option-title">üçΩÔ∏è –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ç—Ä–∏–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>
                            <div class="meal-option-price">260 –≥—Ä–Ω/–¥–µ–Ω—å</div>
                        </div>
                        <div class="meal-option-description">
                            –í–∫–ª—é—á–∞—î: —Å–Ω—ñ–¥–∞–Ω–æ–∫, –æ–±—ñ–¥ —Ç–∞ –≤–µ—á–µ—Ä—é –∑–≥—ñ–¥–Ω–æ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é
                        </div>
                        <button class="select-meal-btn" onclick="selectMealOption('full')">–û–±—Ä–∞—Ç–∏</button>
                    </div>

                    <div class="meal-option" id="partial-meal-option">
                        <div class="meal-option-header">
                            <div class="meal-option-title">üçΩÔ∏è –ß–∞—Å—Ç–∏–Ω–Ω–µ –¥–≤–æ–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>
                            <div class="meal-option-price">200 –≥—Ä–Ω/–¥–µ–Ω—å</div>
                        </div>
                        <div class="meal-option-description">
                            –í–∫–ª—é—á–∞—î: –æ–±—ñ–¥ —Ç–∞ –≤–µ—á–µ—Ä—é –∑–≥—ñ–¥–Ω–æ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é
                        </div>
                        <button class="select-meal-btn" onclick="selectMealOption('partial')">–û–±—Ä–∞—Ç–∏</button>
                    </div>
                </div>
                
                <div class="order-summary">
                    <h4>üìù –ü—ñ–¥—Å—É–º–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</h4>
                    <div id="patient-order-items"></div>
                    <div class="total-price" id="patient-total-price">–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: 0 –≥—Ä–Ω</div>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn btn-success" onclick="placeOrder('patient')">üí≥ –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
                    <button class="btn btn-warning" onclick="clearOrder()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
                </div>
            </div>

            <!-- Employee Order Form -->
            <div id="employee-order-form" class="order-form hidden">
                <h3>üõí –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫)</h3>
                <div id="employee-time-warning" class="time-warning" style="display: none;">
                    ‚ö†Ô∏è –£–≤–∞–≥–∞! –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –æ–±—ñ–¥ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –¥–æ 9:30 –¥–Ω—è –¥–æ—Å—Ç–∞–≤–∫–∏!
                </div>
                
                <div class="employee-form-row">
                    <div class="form-group">
                        <label for="employee-order-date">–î–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</label>
                        <input type="date" id="employee-order-date">
                    </div>
                    
                    <div class="form-group">
                        <label for="employee-diet-type">–¢–∏–ø –¥—ñ—î—Ç–∏:</label>
                        <select id="employee-diet-type">
                            <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞</option>
                            <option value="diet-1">–î—ñ—î—Ç–∞ ‚Ññ1</option>
                            <option value="diet-5">–î—ñ—î—Ç–∞ ‚Ññ5</option>
                            <option value="diet-9">–î—ñ—î—Ç–∞ ‚Ññ9</option>
                            <option value="diet-15">–î—ñ—î—Ç–∞ ‚Ññ15</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="employee-days-count">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤:</label>
                        <input type="number" id="employee-days-count" min="1" max="3" value="1">
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <h4>–í–∞—Ä—ñ–∞–Ω—Ç–∏ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è:</h4>
                    
                    <div class="meal-option" id="employee-full-meal-option">
                        <div class="meal-option-header">
                            <div class="meal-option-title">üçΩÔ∏è –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ç—Ä–∏–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>
                            <div class="meal-option-price">260 –≥—Ä–Ω/–¥–µ–Ω—å</div>
                        </div>
                        <div class="meal-option-description">
                            –í–∫–ª—é—á–∞—î: —Å–Ω—ñ–¥–∞–Ω–æ–∫, –æ–±—ñ–¥ —Ç–∞ –≤–µ—á–µ—Ä—é –∑–≥—ñ–¥–Ω–æ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é
                        </div>
                        <button class="select-meal-btn" onclick="selectEmployeeMealOption('full')">–û–±—Ä–∞—Ç–∏</button>
                    </div>

                    <div class="meal-option" id="employee-partial-meal-option">
                        <div class="meal-option-header">
                            <div class="meal-option-title">üçΩÔ∏è –ß–∞—Å—Ç–∏–Ω–Ω–µ –¥–≤–æ–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>
                            <div class="meal-option-price">200 –≥—Ä–Ω/–¥–µ–Ω—å</div>
                        </div>
                        <div class="meal-option-description">
                            –í–∫–ª—é—á–∞—î: –æ–±—ñ–¥ —Ç–∞ –≤–µ—á–µ—Ä—é –∑–≥—ñ–¥–Ω–æ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é
                        </div>
                        <button class="select-meal-btn" onclick="selectEmployeeMealOption('partial')">–û–±—Ä–∞—Ç–∏</button>
                    </div>
                </div>
                
                <div class="order-summary">
                    <h4>üìù –ü—ñ–¥—Å—É–º–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</h4>
                    <div id="employee-order-items"></div>
                    <div class="total-price" id="employee-total-price">–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: 0 –≥—Ä–Ω</div>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn btn-success" onclick="placeOrder('employee')">üí≥ –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
                    <button class="btn btn-warning" onclick="clearOrder()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin-panel" class="order-form hidden">
                <h3>üëë –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å</h3>
                
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('summary')">üìä –ó–≤–µ–¥–µ–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</button>
                    <button class="admin-tab" onclick="switchAdminTab('departments')">üè• –ü–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö</button>
                    <button class="admin-tab" onclick="switchAdminTab('categories')">üìã –ü–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</button>
                    <button class="admin-tab" onclick="switchAdminTab('kitchen')">üë®‚Äçüç≥ –ö—É—Ö–Ω—è —Ç–∞ —Å–∫–ª–∞–¥</button>
                    <button class="admin-tab" onclick="switchAdminTab('employees')">üë• –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏</button>
                    <button class="admin-tab" onclick="switchAdminTab('structure')">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
                    <button class="admin-tab" onclick="switchAdminTab('export')">üì§ –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö</button>
                </div>

                <!-- Summary Tab -->
                <div id="summary-tab" class="admin-tab-content active">
                    <h4>üìä –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                    <div class="stats-grid" id="general-stats">
                        <!-- Will be filled dynamically -->
                    </div>
                    
                    <h4>üìà –û—Å—Ç–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ó–∞–º–æ–≤–Ω–∏–∫</th>
                                    <th>–¢–∏–ø —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</th>
                                    <th>–°—É–º–∞</th>
                                    <th>–î—ñ—ó</th>
                                </tr>
                            </thead>
                            <tbody id="summary-orders-table">
                                <!-- Will be filled dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Departments Tab -->
                <div id="departments-tab" class="admin-tab-content">
                    <h4>üè• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö</h4>
                    <div class="form-group">
                        <label>–û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è:</label>
                        <select id="department-filter" onchange="filterByDepartment()">
                            <option value="all">–í—Å—ñ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>
                        </select>
                    </div>
                    <div id="department-stats">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>

                <!-- Categories Tab -->
                <div id="categories-tab" class="admin-tab-content">
                    <h4>üìã –†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h4>
                    <div id="category-stats">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>

                <!-- Kitchen Tab -->
                <div id="kitchen-tab" class="admin-tab-content">
                    <h4>üë®‚Äçüç≥ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –∫—É—Ö–Ω—ñ —Ç–∞ —Å–∫–ª–∞–¥—É</h4>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è:</label>
                        <input type="date" id="kitchen-date" onchange="updateKitchenInfo()">
                    </div>
                    
                    <button class="export-btn" onclick="printKitchenOrder()">üñ®Ô∏è –î—Ä—É–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –∫—É—Ö–Ω—ñ</button>
                    <button class="export-btn" onclick="printWarehouseOrder()">üì¶ –î—Ä—É–∫ –¥–ª—è —Å–∫–ª–∞–¥—É</button>
                    
                    <div id="kitchen-info" style="margin-top: 20px;">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>

                <!-- Employees Tab -->
                <div id="employees-tab" class="admin-tab-content">
                    <h4>üë• –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º–∏</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-success" onclick="openEmployeeEditor()">‚ûï –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</button>
                    </div>
                    
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>–ü–Ü–ë</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</th>
                                    <th>–ü–æ—Å–∞–¥–∞</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–î—ñ—ó</th>
                                </tr>
                            </thead>
                            <tbody id="employees-table">
                                <!-- Will be filled dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Structure Tab -->
                <div id="structure-tab" class="admin-tab-content">
                    <h4>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏</h4>
                    
                    <div style="margin-bottom: 30px;">
                        <h5>üè• –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è–º–∏</h5>
                        <button class="btn btn-primary" onclick="openDepartmentEditor()">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</button>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h5>üçΩÔ∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–∏–∂–Ω–µ–≤–∏–º –º–µ–Ω—é</h5>
                        <button class="btn btn-primary" onclick="openWeeklyMenuEditor()">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–∏–∂–Ω–µ–≤–µ –º–µ–Ω—é</button>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h5>üìä –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥—ñ—î—Ç–∞–º–∏</h5>
                        <button class="btn btn-primary" onclick="openDietEditor()">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–∏–ø–∏ –¥—ñ—î—Ç</button>
                    </div>
                </div>

                <!-- Export Tab -->
                <div id="export-tab" class="admin-tab-content">
                    <h4>üì§ –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö –¥–æ –Ü–° –ü–†–û</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –≤—ñ–¥:</label>
                            <input type="date" id="export-date-from">
                        </div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –¥–æ:</label>
                            <input type="date" id="export-date-to">
                        </div>
                        <div class="form-group">
                            <label>–§–æ—Ä–º–∞—Ç:</label>
                            <select id="export-format">
                                <option value="json">JSON</option>
                                <option value="xml">XML</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="export-btn" onclick="exportToAPI()">üì§ –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ API</button>
                        <button class="export-btn" onclick="downloadExport()">üíæ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª</button>
                    </div>
                    
                    <div id="export-preview" style="margin-top: 20px;">
                        <h5>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö:</h5>
                        <textarea id="export-data" style="width: 100%; height: 300px; font-family: monospace;" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Department Editor Modal -->
        <div id="departmentModal" class="edit-modal">
            <div class="edit-modal-content">
                <span class="close" onclick="closeDepartmentEditor()">&times;</span>
                <h3>üè• –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –≤—ñ–¥–¥—ñ–ª–µ–Ω—å</h3>
                
                <div id="departments-list">
                    <!-- Will be filled dynamically -->
                </div>
                
                <button class="btn btn-success" onclick="addNewDepartment()">‚ûï –î–æ–¥–∞—Ç–∏ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</button>
                <button class="btn btn-primary" onclick="saveDepartments()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            </div>
        </div>

        <!-- Weekly Menu Editor Modal -->
        <div id="weeklyMenuModal" class="edit-modal">
            <div class="edit-modal-content">
                <span class="close" onclick="closeWeeklyMenuEditor()">&times;</span>
                <h3>üçΩÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é</h3>
                
                <div class="day-selector">
                    <button class="day-btn active" onclick="selectDay('monday')">–ü–æ–Ω–µ–¥—ñ–ª–æ–∫</button>
                    <button class="day-btn" onclick="selectDay('tuesday')">–í—ñ–≤—Ç–æ—Ä–æ–∫</button>
                    <button class="day-btn" onclick="selectDay('wednesday')">–°–µ—Ä–µ–¥–∞</button>
                    <button class="day-btn" onclick="selectDay('thursday')">–ß–µ—Ç–≤–µ—Ä</button>
                    <button class="day-btn" onclick="selectDay('friday')">–ü'—è—Ç–Ω–∏—Ü—è</button>
                    <button class="day-btn" onclick="selectDay('saturday')">–°—É–±–æ—Ç–∞</button>
                    <button class="day-btn" onclick="selectDay('sunday')">–ù–µ–¥—ñ–ª—è</button>
                </div>
                
                <div id="day-menu-editor">
                    <!-- Will be filled dynamically -->
                </div>
                
                <button class="btn btn-primary" onclick="saveWeeklyMenu()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            </div>
        </div>

        <!-- Employee Editor Modal -->
        <div id="employeeModal" class="edit-modal">
            <div class="edit-modal-content">
                <span class="close" onclick="closeEmployeeEditor()">&times;</span>
                <h3 id="employee-modal-title">üë• –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</h3>
                
                <form id="employee-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emp-firstname">–Ü–º'—è:</label>
                            <input type="text" id="emp-firstname" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è" required>
                        </div>
                        <div class="form-group">
                            <label for="emp-lastname">–ü—Ä—ñ–∑–≤–∏—â–µ:</label>
                            <input type="text" id="emp-lastname" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ" required>
                        </div>
                        <div class="form-group">
                            <label for="emp-patronymic">–ü–æ-–±–∞—Ç—å–∫–æ–≤—ñ:</label>
                            <input type="text" id="emp-patronymic" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ-–±–∞—Ç—å–∫–æ–≤—ñ">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emp-phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:</label>
                            <input type="tel" id="emp-phone" placeholder="+380XXXXXXXXX" required>
                        </div>
                        <div class="form-group">
                            <label for="emp-password">–ü–∞—Ä–æ–ª—å:</label>
                            <div class="password-wrapper">
                                <input type="password" id="emp-password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>
                                <button type="button" class="password-toggle" onclick="togglePassword('emp-password', this)">üëÅ</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="emp-department">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è:</label>
                            <select id="emp-department" required>
                                <option value="">–û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emp-position">–ü–æ—Å–∞–¥–∞:</label>
                            <input type="text" id="emp-position" placeholder="–õ—ñ–∫–∞—Ä, –º–µ–¥—Å–µ—Å—Ç—Ä–∞, —Ç–æ—â–æ" required>
                        </div>
                        <div class="form-group">
                            <label for="emp-role">–†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º—ñ:</label>
                            <select id="emp-role" required>
                                <option value="employee">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option>
                                <option value="doctor">–õ—ñ–∫–∞—Ä</option>
                                <option value="nurse">–ú–µ–¥—Å–µ—Å—Ç—Ä–∞</option>
                                <option value="admin">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            </select>
                        </div>
                    </div>
                </form>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-success" onclick="saveEmployee()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    <button class="btn btn-warning" onclick="closeEmployeeEditor()">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button class="btn btn-danger" id="delete-employee-btn" onclick="deleteEmployee()" style="display: none;">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- Diet Editor Modal -->
        <div id="dietModal" class="edit-modal">
            <div class="edit-modal-content">
                <span class="close" onclick="closeDietEditor()">&times;</span>
                <h3>üìä –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –¥—ñ—î—Ç</h3>
                
                <div id="diets-list">
                    <!-- Will be filled dynamically -->
                </div>
                
                <button class="btn btn-success" onclick="addNewDiet()">‚ûï –î–æ–¥–∞—Ç–∏ –¥—ñ—î—Ç—É</button>
                <button class="btn btn-primary" onclick="saveDiets()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            </div>
        </div>
    </div>
  <script>
        // State Management
        let currentUserType = null;
        let currentEmployee = null;
        let orders = [];
        let selectedMealOption = null;
        let selectedEmployeeMealOption = null;

        // Weekly menu structure
        let weeklyMenu = {
            monday: {
                breakfast: ['–ö–∞—à–∞ –≤—ñ–≤—Å—è–Ω–∞ –∑ –º–∞—Å–ª–æ–º', '–•–ª—ñ–± –∑ –º–∞—Å–ª–æ–º', '–ß–∞–π –∑ —Ü—É–∫—Ä–æ–º'],
                lunch: ['–ë–æ—Ä—â —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π', '–ö–æ—Ç–ª–µ—Ç–∞ –ø–æ-–∫–∏—ó–≤—Å—å–∫–∏ –∑ –∫–∞—Ä—Ç–æ–ø–ª–µ—é', '–°–∞–ª–∞—Ç –æ–≤–æ—á–µ–≤–∏–π', '–ö–æ–º–ø–æ—Ç'],
                dinner: ['–†–∏–±–∞ –∑–∞–ø–µ—á–µ–Ω–∞', '–ö–∞—à–∞ –≥—Ä–µ—á–∞–Ω–∞', '–ß–∞–π –∑ –ª–∏–º–æ–Ω–æ–º']
            },
            tuesday: {
                breakfast: ['–ö–∞—à–∞ –º–∞–Ω–Ω–∞', '–ë—É—Ç–µ—Ä–±—Ä–æ–¥ –∑ —Å–∏—Ä–æ–º', '–ö–∞–≤–∞ –∑ –º–æ–ª–æ–∫–æ–º'],
                lunch: ['–°—É–ø –∫—É—Ä–∏–Ω–∏–π –∑ –ª–æ–∫—à–∏–Ω–æ—é', '–ì—É–ª—è—à —è–ª–æ–≤–∏—á–∏–π –∑ —Ä–∏—Å–æ–º', '–°–∞–ª–∞—Ç –∑ –∫–∞–ø—É—Å—Ç–∏', '–ö–∏—Å—ñ–ª—å'],
                dinner: ['–ö—É—Ä–∫–∞ —Ç—É—à–∫–æ–≤–∞–Ω–∞', '–ö–∞—Ä—Ç–æ–ø–ª—è –≤—ñ–¥–≤–∞—Ä–Ω–∞', '–ß–∞–π –∑–µ–ª–µ–Ω–∏–π']
            },
            wednesday: {
                breakfast: ['–û–º–ª–µ—Ç', '–•–ª—ñ–± –∂–∏—Ç–Ω—ñ–π', '–ö–∞–∫–∞–æ'],
                lunch: ['–°–æ–ª—è–Ω–∫–∞ –º\'—è—Å–Ω–∞', '–†–∏–±–Ω–∞ –∫–æ—Ç–ª–µ—Ç–∞ –∑ –º–∞–∫–∞—Ä–æ–Ω–∞–º–∏', '–°–∞–ª–∞—Ç –∑ –±—É—Ä—è–∫–∞', '–ú–æ—Ä—Å'],
                dinner: ['–ú\'—è—Å–æ —Ç—É—à–∫–æ–≤–∞–Ω–µ', '–ö–∞—à–∞ –ø–µ—Ä–ª–æ–≤–∞', '–ß–∞–π —Ç—Ä–∞–≤—è–Ω–∏–π']
            },
            thursday: {
                breakfast: ['–ö–∞—à–∞ –ø—à–æ–Ω–Ω–∞', '–•–ª—ñ–± –∑ –¥–∂–µ–º–æ–º', '–ß–∞–π —á–æ—Ä–Ω–∏–π'],
                lunch: ['–°—É–ø –æ–≤–æ—á–µ–≤–∏–π', '–ë—ñ—Ñ—à—Ç–µ–∫—Å –∑ –∫–∞—Ä—Ç–æ–ø–ª—è–Ω–∏–º –ø—é—Ä–µ', '–°–∞–ª–∞—Ç –∑ –º–æ—Ä–∫–≤–∏', '–ö–æ–º–ø–æ—Ç –∑ —è–±–ª—É–∫'],
                dinner: ['–ü–µ—á—ñ–Ω–∫–∞ —Ç—É—à–∫–æ–≤–∞–Ω–∞', '–ö–∞—à–∞ —è—á–Ω–µ–≤–∞', '–ß–∞–π –∑ –º\'—è—Ç–æ—é']
            },
            friday: {
                breakfast: ['–ö–∞—à–∞ —Ä–∏—Å–æ–≤–∞', '–ë—É—Ç–µ—Ä–±—Ä–æ–¥ –∑ –∫–æ–≤–±–∞—Å–æ—é', '–ö–∞–≤–∞ —á–æ—Ä–Ω–∞'],
                lunch: ['–ë–æ—Ä—â –∑–µ–ª–µ–Ω–∏–π', '–í—ñ–¥–±–∏–≤–Ω–∞ —Å–≤–∏–Ω—è—á–∞ –∑ –æ–≤–æ—á–∞–º–∏', '–°–∞–ª–∞—Ç –≥—Ä–µ—Ü—å–∫–∏–π', '–£–∑–≤–∞—Ä'],
                dinner: ['–†–∏–±–∞ –≤–∞—Ä–µ–Ω–∞', '–ö–∞—Ä—Ç–æ–ø–ª—è –≤ –º—É–Ω–¥–∏—Ä—ñ', '–ß–∞–π –∑ –º–µ–¥–æ–º']
            },
            saturday: {
                breakfast: ['–°–∏—Ä–Ω–∏–∫–∏', '–°–º–µ—Ç–∞–Ω–∞', '–ß–∞–π –∑ –º–æ–ª–æ–∫–æ–º'],
                lunch: ['–°—É–ø –≥–æ—Ä–æ—Ö–æ–≤–∏–π', '–ì–æ–ª—É–±—Ü—ñ –∑ –º\'—è—Å–æ–º', '–°–∞–ª–∞—Ç –∑ –æ–≥—ñ—Ä–∫—ñ–≤', '–ö–æ–º–ø–æ—Ç –∑ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ñ–≤'],
                dinner: ['–ö–æ—Ç–ª–µ—Ç–∞ –∫—É—Ä—è—á–∞', '–ö–∞—à–∞ –≥—Ä–µ—á–∞–Ω–∞', '–ß–∞–π –∑–µ–ª–µ–Ω–∏–π']
            },
            sunday: {
                breakfast: ['–ö–∞—à–∞ –≤—ñ–≤—Å—è–Ω–∞ –∑ —Ñ—Ä—É–∫—Ç–∞–º–∏', '–ô–æ–≥—É—Ä—Ç', '–ö–∞–∫–∞–æ'],
                lunch: ['–°—É–ø –º\'—è—Å–Ω–∏–π', '–ü–ª–æ–≤ –∑ —è–ª–æ–≤–∏—á–∏–Ω–æ—é', '–°–∞–ª–∞—Ç –≤—ñ—Ç–∞–º—ñ–Ω–Ω–∏–π', '–ú–æ—Ä—Å —è–≥—ñ–¥–Ω–∏–π'],
                dinner: ['–ö—É—Ä–∫–∞ –∑–∞–ø–µ—á–µ–Ω–∞', '–û–≤–æ—á—ñ —Ç—É—à–∫–æ–≤–∞–Ω—ñ', '–ß–∞–π —Ñ—Ä—É–∫—Ç–æ–≤–∏–π']
            }
        };

        let departments = [
            { id: 'cardiology', name: '–ö–∞—Ä–¥—ñ–æ–ª–æ–≥—ñ—á–Ω–µ' },
            { id: 'neurology', name: '–ù–µ–≤—Ä–æ–ª–æ–≥—ñ—á–Ω–µ' },
            { id: 'surgery', name: '–•—ñ—Ä—É—Ä–≥—ñ—á–Ω–µ' },
            { id: 'therapy', name: '–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–Ω–µ' },
            { id: 'pediatrics', name: '–ü–µ–¥—ñ–∞—Ç—Ä–∏—á–Ω–µ' }
        ];

        let diets = [
            { id: 'standard', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞' },
            { id: 'diet-1', name: '–î—ñ—î—Ç–∞ ‚Ññ1' },
            { id: 'diet-5', name: '–î—ñ—î—Ç–∞ ‚Ññ5' },
            { id: 'diet-9', name: '–î—ñ—î—Ç–∞ ‚Ññ9' },
            { id: 'diet-15', name: '–î—ñ—î—Ç–∞ ‚Ññ15' }
        ];

        // Mock employee database
        let employees = {
            '+380501234567': { password: 'doctor123', firstName: '–Ü–≤–∞–Ω', lastName: '–Ü–≤–∞–Ω–æ–≤', patronymic: '–Ü–≤–∞–Ω–æ–≤–∏—á', department: '–ö–∞—Ä–¥—ñ–æ–ª–æ–≥—ñ—á–Ω–µ', position: '–õ—ñ–∫–∞—Ä-–∫–∞—Ä–¥—ñ–æ–ª–æ–≥', role: 'doctor' },
            '+380507654321': { password: 'nurse456', firstName: '–ü–µ—Ç—Ä–∞', lastName: '–ü–µ—Ç—Ä–æ–≤–∞', patronymic: '–ü–µ—Ç—Ä—ñ–≤–Ω–∞', department: '–•—ñ—Ä—É—Ä–≥—ñ—á–Ω–µ', position: '–ú–µ–¥–∏—á–Ω–∞ —Å–µ—Å—Ç—Ä–∞', role: 'nurse' },
            '+380509876543': { password: 'admin789', firstName: '–°–∏–¥–æ—Ä', lastName: '–°–∏–¥–æ—Ä–æ–≤', patronymic: '–°–∏–¥–æ—Ä–æ–≤–∏—á', department: '–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–Ω–µ', position: '–õ—ñ–∫–∞—Ä-—Ç–µ—Ä–∞–ø–µ–≤—Ç', role: 'employee' },
            '+380500000000': { password: 'admin123', firstName: '–ê–¥–º—ñ–Ω', lastName: '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä', patronymic: '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤–∏—á', department: '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è', position: '–ì–æ–ª–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä', role: 'admin' }
        };

        let currentEditEmployeePhone = null;

        let currentEditDay = 'monday';

        // Session Management
        function saveSession() {
            if (currentEmployee) {
                sessionStorage.setItem('userSession', JSON.stringify({
                    type: currentUserType,
                    employee: currentEmployee,
                    loginTime: new Date().toISOString()
                }));
            } else if (currentUserType === 'patient') {
                sessionStorage.setItem('userSession', JSON.stringify({
                    type: 'patient',
                    loginTime: new Date().toISOString()
                }));
            }
        }

        function loadSession() {
            const session = sessionStorage.getItem('userSession');
            if (session) {
                const sessionData = JSON.parse(session);
                const loginTime = new Date(sessionData.loginTime);
                const now = new Date();
                const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);

                // Session expires after 8 hours
                if (hoursSinceLogin < 8) {
                    currentUserType = sessionData.type;
                    currentEmployee = sessionData.employee || null;
                    showApp();
                    return true;
                } else {
                    sessionStorage.removeItem('userSession');
                }
            }
            return false;
        }

        function clearSession() {
            sessionStorage.removeItem('userSession');
        }

        // Initialize
        function init() {
            // Load saved data from localStorage
            loadSavedData();

            // Try to restore session
            if (!loadSession()) {
                document.getElementById('welcome-screen').style.display = 'block';
            }

            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            setMinDate();
            checkTimeRestrictions();
            renderWeeklyMenu();
            updateDepartmentSelects();
        }

        function loadSavedData() {
            // Load saved weekly menu
            const savedMenu = localStorage.getItem('hospitalWeeklyMenu');
            if (savedMenu) {
                weeklyMenu = JSON.parse(savedMenu);
            }

            // Load saved departments
            const savedDepartments = localStorage.getItem('hospitalDepartments');
            if (savedDepartments) {
                departments = JSON.parse(savedDepartments);
            }

            // Load saved diets
            const savedDiets = localStorage.getItem('hospitalDiets');
            if (savedDiets) {
                diets = JSON.parse(savedDiets);
            }

            // Load saved orders
            const savedOrders = localStorage.getItem('hospitalOrders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            }

            // Load saved employees
            const savedEmployees = localStorage.getItem('hospitalEmployees');
            if (savedEmployees) {
                employees = JSON.parse(savedEmployees);
            }
        }

        function saveData() {
            localStorage.setItem('hospitalWeeklyMenu', JSON.stringify(weeklyMenu));
            localStorage.setItem('hospitalDepartments', JSON.stringify(departments));
            localStorage.setItem('hospitalDiets', JSON.stringify(diets));
            localStorage.setItem('hospitalOrders', JSON.stringify(orders));
            localStorage.setItem('hospitalEmployees', JSON.stringify(employees));
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('uk-UA');
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function setMinDate() {
            const now = new Date();
            const currentHour = now.getHours();

            // --- –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            let minDatePatient;
            if (currentHour >= 14) {
                minDatePatient = new Date(now);
                minDatePatient.setDate(now.getDate() + 2);
            } else {
                minDatePatient = new Date(now);
                minDatePatient.setDate(now.getDate() + 1);
            }
            const minDateStringPatient = minDatePatient.toISOString().split('T')[0];

            const patientDateInput = document.getElementById('patient-order-date');
            if (patientDateInput) {
                patientDateInput.min = minDateStringPatient;
                patientDateInput.value = minDateStringPatient;
            }

            // –ò–ó–ú–ï–ù–ï–ù–û: –õ–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.
            // –¢–µ–ø–µ—Ä—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å.
            const employeeDateInput = document.getElementById('employee-order-date');
            if (employeeDateInput) {
                const minDateEmployee = new Date(now);
                const minDateStringEmployee = minDateEmployee.toISOString().split('T')[0];
                employeeDateInput.min = minDateStringEmployee;
                employeeDateInput.value = minDateStringEmployee;
            }
        }

        function checkTimeRestrictions() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTime = currentHour + currentMinutes / 60;

            // --- –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            const patientWarning = document.getElementById('time-warning');
            if (patientWarning) {
                if (currentHour >= 14) {
                    patientWarning.style.display = 'block';
                    patientWarning.innerHTML = `‚ö†Ô∏è –£–≤–∞–≥–∞! –ó–∞—Ä–∞–∑ ${currentHour}:${String(currentMinutes).padStart(2, '0')}. –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –Ω–∞ –ø—ñ—Å–ª—è–∑–∞–≤—Ç—Ä–∞ —Ç–∞ –¥–∞–ª—ñ!`;
                } else {
                    patientWarning.style.display = 'block';
                    patientWarning.innerHTML = `‚úÖ –î–æ 14:00 –º–æ–∂–Ω–∞ –∑–∞–º–æ–≤–ª—è—Ç–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞. –ó–∞—Ä–∞–∑ ${currentHour}:${String(currentMinutes).padStart(2, '0')}.`;
                    patientWarning.style.borderColor = '#27ae60';
                    patientWarning.style.backgroundColor = 'rgba(46, 204, 113, 0.1)';
                    patientWarning.style.color = '#229954';
                }
            }

            // –ò–ó–ú–ï–ù–ï–ù–û: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            const employeeWarning = document.getElementById('employee-time-warning');
            if (employeeWarning) {
                const employeeOrderDateInput = document.getElementById('employee-order-date');
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–µ–∂–¥–µ —á–µ–º —á–∏—Ç–∞—Ç—å –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ
                if (employeeOrderDateInput) {
                    const orderDate = new Date(employeeOrderDateInput.value);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
                    const isToday = now.toDateString() === orderDate.toDateString();
                    const orderButton = document.querySelector('#employee-order-form .btn-success');

                    if (isToday && currentTime > 9.5) {
                        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –∏ –≤—Ä–µ–º—è —É–∂–µ –ø–æ—Å–ª–µ 9:30
                        employeeWarning.style.display = 'block';
                        employeeWarning.innerHTML = `‚ö†Ô∏è –£–≤–∞–≥–∞! –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –º–æ–∂–Ω–∞ –±—É–ª–æ –∑—Ä–æ–±–∏—Ç–∏ –ª–∏—à–µ –¥–æ 9:30.`;
                        if (orderButton) orderButton.disabled = true;

                    } else {
                        // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö (–∑–∞–∫–∞–∑ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ —Ä–∞–Ω—å—à–µ 9:30)
                        employeeWarning.style.display = 'none';
                        if (orderButton) orderButton.disabled = false;
                    }
                }
            }
        }

        // Render weekly menu
        function renderWeeklyMenu() {
            const menuContainer = document.getElementById('weekly-menu');
            if (!menuContainer) return;

            menuContainer.innerHTML = '';

            const dayNames = {
                monday: '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫',
                tuesday: '–í—ñ–≤—Ç–æ—Ä–æ–∫',
                wednesday: '–°–µ—Ä–µ–¥–∞',
                thursday: '–ß–µ—Ç–≤–µ—Ä',
                friday: '–ü\'—è—Ç–Ω–∏—Ü—è',
                saturday: '–°—É–±–æ—Ç–∞',
                sunday: '–ù–µ–¥—ñ–ª—è'
            };

            Object.keys(weeklyMenu).forEach(day => {
                const dayData = weeklyMenu[day];
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-menu';

                dayDiv.innerHTML = `
                    <div class="day-header">
                        <span>${dayNames[day]}</span>
                    </div>
                    <div class="meal-type">
                        <h4>üåÖ –°–Ω—ñ–¥–∞–Ω–æ–∫</h4>
                        <div class="meal-items">${dayData.breakfast.join(', ')}</div>
                    </div>
                    <div class="meal-type">
                        <h4>üçΩÔ∏è –û–±—ñ–¥</h4>
                        <div class="meal-items">${dayData.lunch.join(', ')}</div>
                    </div>
                    <div class="meal-type">
                        <h4>üåô –í–µ—á–µ—Ä—è</h4>
                        <div class="meal-items">${dayData.dinner.join(', ')}</div>
                    </div>
                `;

                menuContainer.appendChild(dayDiv);
            });
        }

        // Update department selects
        function updateDepartmentSelects() {
            const patientDeptSelect = document.getElementById('patient-department');
            const deptFilterSelect = document.getElementById('department-filter');

            if (patientDeptSelect) {
                patientDeptSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>';
                departments.forEach(dept => {
                    patientDeptSelect.innerHTML += `<option value="${dept.id}">${dept.name}</option>`;
                });
            }

            if (deptFilterSelect) {
                deptFilterSelect.innerHTML = '<option value="all">–í—Å—ñ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>';
                departments.forEach(dept => {
                    deptFilterSelect.innerHTML += `<option value="${dept.id}">${dept.name}</option>`;
                });
            }
        }

        // Meal option selection
        function selectMealOption(option) {
            selectedMealOption = option;

            // Update UI
            const fullOption = document.getElementById('full-meal-option');
            const partialOption = document.getElementById('partial-meal-option');

            if (option === 'full') {
                fullOption.classList.add('selected');
                partialOption.classList.remove('selected');
                fullOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞–Ω–æ ‚úì';
                fullOption.querySelector('.select-meal-btn').classList.add('selected');
                partialOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞—Ç–∏';
                partialOption.querySelector('.select-meal-btn').classList.remove('selected');
            } else {
                partialOption.classList.add('selected');
                fullOption.classList.remove('selected');
                partialOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞–Ω–æ ‚úì';
                partialOption.querySelector('.select-meal-btn').classList.add('selected');
                fullOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞—Ç–∏';
                fullOption.querySelector('.select-meal-btn').classList.remove('selected');
            }

            updateOrderSummary();
        }

        function selectEmployeeMealOption(option) {
            selectedEmployeeMealOption = option;

            // Update UI
            const fullOption = document.getElementById('employee-full-meal-option');
            const partialOption = document.getElementById('employee-partial-meal-option');

            if (option === 'full') {
                fullOption.classList.add('selected');
                partialOption.classList.remove('selected');
                fullOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞–Ω–æ ‚úì';
                fullOption.querySelector('.select-meal-btn').classList.add('selected');
                partialOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞—Ç–∏';
                partialOption.querySelector('.select-meal-btn').classList.remove('selected');
            } else {
                partialOption.classList.add('selected');
                fullOption.classList.remove('selected');
                partialOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞–Ω–æ ‚úì';
                partialOption.querySelector('.select-meal-btn').classList.add('selected');
                fullOption.querySelector('.select-meal-btn').textContent = '–û–±—Ä–∞—Ç–∏';
                fullOption.querySelector('.select-meal-btn').classList.remove('selected');
            }

            updateEmployeeOrderSummary();
        }

        function updateOrderSummary() {
            if (!selectedMealOption) {
                const itemsDiv = document.getElementById('patient-order-items');
                const priceDiv = document.getElementById('patient-total-price');
                if (itemsDiv) itemsDiv.innerHTML = '<div style="text-align: center; color: #7f8c8d;">–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>';
                if (priceDiv) priceDiv.textContent = '–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: 0 –≥—Ä–Ω';
                return;
            }

            const daysInput = document.getElementById('patient-days-count');
            const daysCount = daysInput ? parseInt(daysInput.value) || 1 : 1;

            const pricePerDay = selectedMealOption === 'full' ? 260 : 200;
            const totalAmount = pricePerDay * daysCount;

            const mealType = selectedMealOption === 'full' ? '–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ç—Ä–∏–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è' : '–ß–∞—Å—Ç–∏–Ω–Ω–µ –¥–≤–æ–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è';
            const mealDescription = selectedMealOption === 'full' ?
                '—Å–Ω—ñ–¥–∞–Ω–æ–∫, –æ–±—ñ–¥, –≤–µ—á–µ—Ä—è' :
                '–æ–±—ñ–¥, –≤–µ—á–µ—Ä—è';

            const summary = `
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>${mealType} √ó ${daysCount} ${daysCount > 1 ? '–¥–Ω—ñ–≤' : '–¥–µ–Ω—å'}</span>
                    <span>${totalAmount} –≥—Ä–Ω</span>
                </div>
                <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 5px;">
                    –í–∫–ª—é—á–∞—î: ${mealDescription} –∑–≥—ñ–¥–Ω–æ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é
                </div>
            `;

            const itemsDiv = document.getElementById('patient-order-items');
            const priceDiv = document.getElementById('patient-total-price');
            if (itemsDiv) itemsDiv.innerHTML = summary;
            if (priceDiv) priceDiv.textContent = `–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: ${totalAmount} –≥—Ä–Ω`;
        }

        function updateEmployeeOrderSummary() {
            if (!selectedEmployeeMealOption) {
                const itemsDiv = document.getElementById('employee-order-items');
                const priceDiv = document.getElementById('employee-total-price');
                if (itemsDiv) itemsDiv.innerHTML = '<div style="text-align: center; color: #7f8c8d;">–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>';
                if (priceDiv) priceDiv.textContent = '–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: 0 –≥—Ä–Ω';
                return;
            }

            const daysInput = document.getElementById('employee-days-count');
            const daysCount = daysInput ? parseInt(daysInput.value) || 1 : 1;

            const pricePerDay = selectedEmployeeMealOption === 'full' ? 260 : 200;
            const totalAmount = pricePerDay * daysCount;

            const mealType = selectedEmployeeMealOption === 'full' ? '–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ç—Ä–∏–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è' : '–ß–∞—Å—Ç–∏–Ω–Ω–µ –¥–≤–æ–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è';
            const mealDescription = selectedEmployeeMealOption === 'full' ?
                '—Å–Ω—ñ–¥–∞–Ω–æ–∫, –æ–±—ñ–¥, –≤–µ—á–µ—Ä—è' :
                '–æ–±—ñ–¥, –≤–µ—á–µ—Ä—è';

            const summary = `
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>${mealType} √ó ${daysCount} ${daysCount > 1 ? '–¥–Ω—ñ–≤' : '–¥–µ–Ω—å'}</span>
                    <span>${totalAmount} –≥—Ä–Ω</span>
                </div>
                <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 5px;">
                    –í–∫–ª—é—á–∞—î: ${mealDescription} –∑–≥—ñ–¥–Ω–æ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –º–µ–Ω—é
                </div>
            `;

            const itemsDiv = document.getElementById('employee-order-items');
            const priceDiv = document.getElementById('employee-total-price');
            if (itemsDiv) itemsDiv.innerHTML = summary;
            if (priceDiv) priceDiv.textContent = `–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: ${totalAmount} –≥—Ä–Ω`;
        }

        // Modal functions
        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('user-type-selection').style.display = 'block';
            document.getElementById('employee-login').style.display = 'none';
        }

        function selectUserType(type) {
            if (type === 'patient') {
                currentUserType = 'patient';
                saveSession();
                closeLoginModal();
                showApp();
            } else if (type === 'employee') {
                document.getElementById('user-type-selection').style.display = 'none';
                document.getElementById('employee-login').style.display = 'block';
            }
        }

        function backToUserSelection() {
            document.getElementById('user-type-selection').style.display = 'block';
            document.getElementById('employee-login').style.display = 'none';
            document.getElementById('employee-phone').value = '';
            document.getElementById('employee-password').value = '';
        }

        function loginEmployee() {
            const phone = document.getElementById('employee-phone').value;
            const password = document.getElementById('employee-password').value;

            if (!phone || !password) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É —Ç–∞ –ø–∞—Ä–æ–ª—å');
                return;
            }

            if (employees[phone] && employees[phone].password === password) {
                currentUserType = 'employee';
                currentEmployee = employees[phone];
                saveSession();
                closeLoginModal();
                showApp();
            } else {
                alert('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É –∞–±–æ –ø–∞—Ä–æ–ª—å');
            }
        }

        function showApp() {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';

            const userDisplay = document.getElementById('user-type-display');
            if (currentUserType === 'patient') {
                userDisplay.textContent = 'üë§ –ü–∞—Ü—ñ—î–Ω—Ç';
                document.getElementById('patient-order-form').classList.remove('hidden');
                document.getElementById('employee-order-form').classList.add('hidden');
                document.getElementById('admin-panel').classList.add('hidden');
            } else if (currentUserType === 'employee') {
                const fullName = `${currentEmployee.lastName} ${currentEmployee.firstName} ${currentEmployee.patronymic}`;
                userDisplay.textContent = `üë®‚Äç‚öïÔ∏è ${fullName}`;
                document.getElementById('employee-order-form').classList.remove('hidden');
                document.getElementById('patient-order-form').classList.add('hidden');
                document.getElementById('admin-panel').classList.add('hidden');

                if (currentEmployee.role === 'admin') {
                    document.getElementById('admin-panel').classList.remove('hidden');
                    userDisplay.textContent = `üëë ${fullName} (–ê–¥–º—ñ–Ω)`;
                    updateAdminPanel();
                }
            }

            updateOrderHistory();
            checkTimeRestrictions(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        }

        function logout() {
            currentUserType = null;
            currentEmployee = null;
            selectedMealOption = null;
            selectedEmployeeMealOption = null;
            clearSession();
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('welcome-screen').style.display = 'block';
            clearOrder();
        }

        function placeOrder(userType) {
            const selectedOption = userType === 'patient' ? selectedMealOption : selectedEmployeeMealOption;

            if (!selectedOption) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è');
                return;
            }

            let orderData = {};

            if (userType === 'patient') {
                const department = document.getElementById('patient-department').value;
                const room = document.getElementById('patient-room').value;
                const patientName = document.getElementById('patient-name').value;
                const orderDate = document.getElementById('patient-order-date').value;
                const dietType = document.getElementById('patient-diet-type').value;
                const daysCount = document.getElementById('patient-days-count').value;

                if (!department || !room || !patientName || !orderDate) {
                    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è');
                    return;
                }

                const pricePerDay = selectedOption === 'full' ? 260 : 200;
                const totalAmount = pricePerDay * parseInt(daysCount);

                orderData = {
                    type: 'patient',
                    department,
                    room,
                    patientName,
                    orderDate,
                    dietType,
                    daysCount,
                    mealOption: selectedOption,
                    amount: totalAmount
                };
            } else if (userType === 'employee') {
                const orderDate = document.getElementById('employee-order-date').value;
                const dietType = document.getElementById('employee-diet-type').value;
                const daysCount = document.getElementById('employee-days-count').value;

                if (!orderDate) {
                    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è');
                    return;
                }

                const pricePerDay = selectedOption === 'full' ? 260 : 200;
                const totalAmount = pricePerDay * parseInt(daysCount);

                const fullName = `${currentEmployee.lastName} ${currentEmployee.firstName} ${currentEmployee.patronymic}`;

                orderData = {
                    type: 'employee',
                    employeeName: fullName,
                    employeeDepartment: currentEmployee.department,
                    orderDate,
                    dietType,
                    daysCount,
                    mealOption: selectedOption,
                    amount: totalAmount
                };
            }

            const paymentConfirmed = confirm(`–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—É–º—É ${orderData.amount} –≥—Ä–Ω?`);

            if (paymentConfirmed) {
                const order = {
                    id: Date.now(),
                    ...orderData,
                    status: '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ',
                    items: getMealItems(selectedOption),
                    createdAt: new Date().toLocaleString('uk-UA')
                };

                orders.push(order);
                saveData();

                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.innerHTML = `‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ! –ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${order.id}`;

                const formContainer = userType === 'patient' ?
                    document.getElementById('patient-order-form') :
                    document.getElementById('employee-order-form');

                if (formContainer) {
                    formContainer.insertBefore(successDiv, formContainer.firstChild);
                    setTimeout(() => successDiv.remove(), 5000);
                }

                clearOrder();
                updateOrderHistory();

                if (currentEmployee && currentEmployee.role === 'admin') {
                    updateAdminPanel();
                }
            }
        }

        function getMealItems(mealOption) {
            const mealType = mealOption === 'full' ? '–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ç—Ä–∏–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è' : '–ß–∞—Å—Ç–∏–Ω–Ω–µ –¥–≤–æ–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è';
            const price = mealOption === 'full' ? 260 : 200;
            const description = mealOption === 'full' ?
                '–í–∫–ª—é—á–∞—î: —Å–Ω—ñ–¥–∞–Ω–æ–∫, –æ–±—ñ–¥, –≤–µ—á–µ—Ä—è' :
                '–í–∫–ª—é—á–∞—î: –æ–±—ñ–¥, –≤–µ—á–µ—Ä—è';

            return [{
                name: mealType,
                description: description,
                quantity: 1,
                unitPrice: price,
                totalPrice: price
            }];
        }

        function clearOrder() {
            selectedMealOption = null;
            selectedEmployeeMealOption = null;

            // Reset patient form
            document.getElementById('patient-department').value = '';
            document.getElementById('patient-room').value = '';
            document.getElementById('patient-name').value = '';
            document.getElementById('patient-days-count').value = 1;

            // Reset employee form
            document.getElementById('employee-days-count').value = 1;

            // Reset meal option selections
            document.querySelectorAll('.meal-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelectorAll('.select-meal-btn').forEach(btn => {
                btn.textContent = '–û–±—Ä–∞—Ç–∏';
                btn.classList.remove('selected');
            });

            updateOrderSummary();
            updateEmployeeOrderSummary();
        }

        function updateOrderHistory() {
            const historyDiv = document.getElementById('order-history');

            if (!historyDiv) return;

            // Filter orders by current user
            let userOrders = [];
            if (currentUserType === 'patient') {
                // For patients, we could filter by some patient identifier if needed
                // For now, showing all patient orders since we don't have patient authentication
                userOrders = orders.filter(o => o.type === 'patient');
            } else if (currentUserType === 'employee' && currentEmployee) {
                // For employees, show only their orders
                const fullName = `${currentEmployee.lastName} ${currentEmployee.firstName} ${currentEmployee.patronymic}`;
                userOrders = orders.filter(o =>
                    o.type === 'employee' &&
                    o.employeeName === fullName
                );
            }

            if (userOrders.length === 0) {
                historyDiv.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">–ü–æ–∫–∏ —â–æ –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î</div>';
                return;
            }

            let historyHTML = '';
            userOrders.slice(-3).reverse().forEach(order => {
                const mealTypeText = order.mealOption === 'full' ? '–ü–æ–≤–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è' : '–ß–∞—Å—Ç–∫–æ–≤–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è';
                const departmentName = departments.find(d => d.id === order.department)?.name || order.department;
                historyHTML += `
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <div style="font-weight: bold;">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${order.id}</div>
                        <div>–î–∞—Ç–∞: ${order.orderDate}</div>
                        ${order.type === 'patient' ?
                            `<div>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è: ${departmentName}, –ü–∞–ª–∞—Ç–∞: ${order.room}</div>
                             <div>–ü–∞—Ü—ñ—î–Ω—Ç: ${order.patientName}</div>` :
                            `<div>–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫: ${order.employeeName}</div>
                             <div>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è: ${order.employeeDepartment}</div>`
                        }
                        <div>–¢–∏–ø –¥—ñ—î—Ç–∏: ${order.dietType}</div>
                        <div>–¢–∏–ø —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è: ${mealTypeText}</div>
                        <div>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤: ${order.daysCount}</div>
                        <div style="color: #27ae60; font-weight: bold;">–°—É–º–∞: ${order.amount} –≥—Ä–Ω</div>
                        <div style="color: #27ae60;">–°—Ç–∞—Ç—É—Å: ${order.status}</div>
                        <div style="font-size: 0.9em; color: #7f8c8d;">–°—Ç–≤–æ—Ä–µ–Ω–æ: ${order.createdAt}</div>
                    </div>
                `;
            });

            historyDiv.innerHTML = historyHTML;
        }

        // –ò–ó–ú–ï–ù–ï–ù–û: –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
        function clearOrderHistory() {
            const confirmation = confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–º–æ–≤–ª–µ–Ω—å? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ –±—É–¥–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏.");

            if (confirmation) {
                orders = []; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
                localStorage.removeItem('hospitalOrders'); // –£–¥–∞–ª—è–µ–º –∑–∞–∫–∞–∑—ã –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateOrderHistory();

                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                if (currentEmployee && currentEmployee.role === 'admin') {
                    updateAdminPanel();
                }

                alert("–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –æ—á–∏—â–µ–Ω–∞.");
            }
        }


        // Admin Panel Functions
        function switchAdminTab(tabName, event) {
            // Hide all tabs
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Add active class to clicked button
            if (event && event.target) {
                event.target.classList.add('active');
            }


            // Update tab content
            if (tabName === 'summary') {
                updateGeneralStats();
                updateSummaryTable();
            } else if (tabName === 'departments') {
                updateDepartmentStats();
            } else if (tabName === 'categories') {
                updateCategoryStats();
            } else if (tabName === 'kitchen') {
                updateKitchenInfo();
            } else if (tabName === 'employees') {
                updateEmployeesTable();
            } else if (tabName === 'export') {
                prepareExportData();
            }
        }

        function updateAdminPanel() {
            updateGeneralStats();
            updateSummaryTable();
            updateEmployeesTable();
        }

        function updateGeneralStats() {
            const statsDiv = document.getElementById('general-stats');
            if (!statsDiv) return;

            const totalOrders = orders.length;
            const patientOrders = orders.filter(o => o.type === 'patient').length;
            const employeeOrders = orders.filter(o => o.type === 'employee').length;
            const fullMealOrders = orders.filter(o => o.mealOption === 'full').length;
            const partialMealOrders = orders.filter(o => o.mealOption === 'partial').length;
            const totalRevenue = orders.reduce((sum, o) => sum + o.amount, 0);
            const avgOrderValue = totalOrders > 0 ? (totalRevenue / totalOrders).toFixed(2) : 0;

            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(o => o.orderDate === today).length;

            statsDiv.innerHTML = `
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="stat-value">${totalOrders}</div>
                    <div class="stat-label">–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                    <div class="stat-value">${patientOrders}</div>
                    <div class="stat-label">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                    <div class="stat-value">${employeeOrders}</div>
                    <div class="stat-label">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                    <div class="stat-value">${fullMealOrders}</div>
                    <div class="stat-label">–ü–æ–≤–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                    <div class="stat-value">${partialMealOrders}</div>
                    <div class="stat-label">–ß–∞—Å—Ç–∫–æ–≤–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                    <div class="stat-value">${totalRevenue} –≥—Ä–Ω</div>
                    <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);">
                    <div class="stat-value">${avgOrderValue} –≥—Ä–Ω</div>
                    <div class="stat-label">–°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);">
                    <div class="stat-value">${todayOrders}</div>
                    <div class="stat-label">–ó–∞–º–æ–≤–ª–µ–Ω—å —Å—å–æ–≥–æ–¥–Ω—ñ</div>
                </div>
            `;
        }

        function updateSummaryTable() {
            const tableBody = document.getElementById('summary-orders-table');
            if (!tableBody) return;

            if (orders.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            –ù–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            const sortedOrders = [...orders].reverse();

            sortedOrders.slice(0, 10).forEach(order => {
                const mealBadge = order.mealOption === 'full' ?
                    '<span style="background: #f39c12; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">–ü–æ–≤–Ω–µ</span>' :
                    '<span style="background: #3498db; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">–ß–∞—Å—Ç–∫–æ–≤–µ</span>';
                const departmentName = departments.find(d => d.id === order.department)?.name || order.department;
                tableHTML += `
                    <tr>
                        <td>#${order.id.toString().slice(-4)}</td>
                        <td>${order.orderDate}</td>
                        <td>
                            <span style="padding: 3px 8px; border-radius: 15px; font-size: 12px; font-weight: bold;
                                ${order.type === 'patient' ? 'background: rgba(46,204,113,0.2); color: #27ae60' : 'background: rgba(231,76,60,0.2); color: #e74c3c'}">
                                ${order.type === 'patient' ? '–ü–∞—Ü—ñ—î–Ω—Ç' : '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫'}
                            </span>
                        </td>
                        <td>
                            ${order.type === 'patient' ?
                                `<strong>${order.patientName}</strong><br><small>${departmentName}, –ü–∞–ª–∞—Ç–∞ ${order.room}</small>` :
                                `<strong>${order.employeeName}</strong><br><small>${order.employeeDepartment}</small>`
                            }
                        </td>
                        <td>${mealBadge}</td>
                        <td style="font-weight: bold; color: #27ae60;">${order.amount} –≥—Ä–Ω</td>
                        <td>
                            <button onclick="showOrderDetails('${order.id}')" style="background: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                –î–µ—Ç–∞–ª—ñ
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function updateDepartmentStats() {
            const container = document.getElementById('department-stats');
            if (!container) return;

            const deptStats = {};

            departments.forEach(dept => {
                deptStats[dept.id] = {
                    name: dept.name,
                    totalOrders: 0,
                    fullMealOrders: 0,
                    partialMealOrders: 0,
                    totalRevenue: 0,
                    patients: new Set(),
                    diets: {}
                };
            });

            orders.forEach(order => {
                if (order.type === 'patient' && deptStats[order.department]) {
                    deptStats[order.department].totalOrders++;
                    if (order.mealOption === 'full') {
                        deptStats[order.department].fullMealOrders++;
                    } else {
                        deptStats[order.department].partialMealOrders++;
                    }
                    deptStats[order.department].totalRevenue += order.amount;
                    deptStats[order.department].patients.add(order.patientName);

                    if (!deptStats[order.department].diets[order.dietType]) {
                        deptStats[order.department].diets[order.dietType] = 0;
                    }
                    deptStats[order.department].diets[order.dietType]++;
                }
            });

            let html = '<div class="stats-grid">';

            Object.keys(deptStats).forEach(deptId => {
                const stats = deptStats[deptId];
                if (stats.totalOrders > 0) {
                    html += `
                        <div class="card" style="margin: 10px 0;">
                            <h4>${stats.name}</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                                <div>
                                    <strong>–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å:</strong> ${stats.totalOrders}
                                </div>
                                <div>
                                    <strong>–£–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤:</strong> ${stats.patients.size}
                                </div>
                                <div>
                                    <strong>–ü–æ–≤–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è:</strong> ${stats.fullMealOrders}
                                </div>
                                <div>
                                    <strong>–ß–∞—Å—Ç–∫–æ–≤–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è:</strong> ${stats.partialMealOrders}
                                </div>
                                <div>
                                    <strong>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞:</strong> ${stats.totalRevenue} –≥—Ä–Ω
                                </div>
                                <div>
                                    <strong>–°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫:</strong> ${(stats.totalRevenue / stats.totalOrders || 0).toFixed(2)} –≥—Ä–Ω
                                </div>
                            </div>
                            <div>
                                <strong>–†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –¥—ñ—î—Ç–∞—Ö:</strong>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    ${Object.entries(stats.diets).map(([diet, count]) =>
                                        `<li>${diets.find(d=>d.id === diet)?.name || diet}: ${count} –∑–∞–º–æ–≤–ª–µ–Ω—å</li>`
                                    ).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                }
            });

            html += '</div>';
            container.innerHTML = html || '<p style="text-align: center; color: #7f8c8d;">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
        }

        function updateCategoryStats() {
            const container = document.getElementById('category-stats');
            if (!container) return;

            // Calculate statistics by categories
            const categoryStats = {
                byType: { patient: 0, employee: 0 },
                byMealOption: { full: 0, partial: 0 },
                byDiet: {},
                byDepartment: {}
            };

            orders.forEach(order => {
                // By type
                categoryStats.byType[order.type]++;

                // By meal option
                if (order.mealOption) {
                    categoryStats.byMealOption[order.mealOption]++;
                }

                // By diet
                const dietName = diets.find(d => d.id === order.dietType)?.name || order.dietType;
                if (!categoryStats.byDiet[dietName]) {
                    categoryStats.byDiet[dietName] = 0;
                }
                categoryStats.byDiet[dietName]++;

                // By department
                const deptId = order.type === 'patient' ? order.department : order.employeeDepartment;
                const deptName = departments.find(d => d.id === deptId)?.name || deptId;
                if (!categoryStats.byDepartment[deptName]) {
                    categoryStats.byDepartment[deptName] = 0;
                }
                categoryStats.byDepartment[deptName]++;
            });

            let html = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; flex-wrap: wrap;">
                    <div class="card">
                        <h5>–ó–∞ —Ç–∏–ø–æ–º –∑–∞–º–æ–≤–Ω–∏–∫–∞</h5>
                        <canvas id="typeChart" width="200" height="200"></canvas>
                        <div style="margin-top: 15px;">
                            <div>–ü–∞—Ü—ñ—î–Ω—Ç–∏: ${categoryStats.byType.patient}</div>
                            <div>–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏: ${categoryStats.byType.employee}</div>
                        </div>
                    </div>

                    <div class="card">
                        <h5>–ó–∞ —Ç–∏–ø–æ–º —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h5>
                        <canvas id="mealChart" width="200" height="200"></canvas>
                        <div style="margin-top: 15px;">
                            <div>–ü–æ–≤–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è: ${categoryStats.byMealOption.full}</div>
                            <div>–ß–∞—Å—Ç–∫–æ–≤–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è: ${categoryStats.byMealOption.partial}</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h5>–†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –¥—ñ—î—Ç–∞—Ö</h5>
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>–¢–∏–ø –¥—ñ—î—Ç–∏</th>
                                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω—å</th>
                                <th>–í—ñ–¥—Å–æ—Ç–æ–∫</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(categoryStats.byDiet)
                                .sort((a, b) => b[1] - a[1])
                                .map(([diet, count]) => `
                                    <tr>
                                        <td>${diet}</td>
                                        <td>${count}</td>
                                        <td>${((count / orders.length) * 100 || 0).toFixed(1)}%</td>
                                    </tr>
                                `).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;

            // Draw simple pie charts
            drawPieChart('typeChart',
                [categoryStats.byType.patient, categoryStats.byType.employee],
                ['#27ae60', '#e74c3c']);

            drawPieChart('mealChart',
                [categoryStats.byMealOption.full, categoryStats.byMealOption.partial],
                ['#f39c12', '#3498db']);
        }

        function drawPieChart(canvasId, data, colors) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 70;

            let total = data.reduce((a, b) => a + b, 0);
            if (total === 0) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.fillStyle = '#ecf0f1';
                ctx.fill();
                return;
            };

            let currentAngle = -Math.PI / 2;

            data.forEach((value, i) => {
                const sliceAngle = (value / total) * 2 * Math.PI;

                // Draw slice
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = colors[i];
                ctx.fill();

                currentAngle += sliceAngle;
            });
        }

        function updateKitchenInfo() {
            const container = document.getElementById('kitchen-info');
            const dateInput = document.getElementById('kitchen-date');

            if (!container || !dateInput) return;

            if (!dateInput.value) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateInput.value = tomorrow.toISOString().split('T')[0];
            }

            const selectedDate = dateInput.value;
            const dateOrders = orders.filter(o => o.orderDate === selectedDate);

            if (dateOrders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–ù–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–∞ –æ–±—Ä–∞–Ω—É –¥–∞—Ç—É</p>';
                return;
            }

            // Calculate meal requirements
            const mealRequirements = {
                breakfast: 0,
                lunch: 0,
                dinner: 0
            };

            const departmentSummary = {};

            dateOrders.forEach(order => {
                const deptId = order.type === 'patient' ? order.department : '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏';
                const deptName = departments.find(d => d.id === deptId)?.name || deptId;
                if (!departmentSummary[deptName]) {
                    departmentSummary[deptName] = {
                        orders: 0,
                        fullMeals: 0,
                        partialMeals: 0
                    };
                }
                departmentSummary[deptName].orders++;
                const days = parseInt(order.daysCount) || 1;
                if (order.mealOption === 'full') {
                    departmentSummary[deptName].fullMeals += days;
                    mealRequirements.breakfast += days;
                    mealRequirements.lunch += days;
                    mealRequirements.dinner += days;
                } else {
                    departmentSummary[deptName].partialMeals += days;
                    mealRequirements.lunch += days;
                    mealRequirements.dinner += days;
                }
            });

            let html = `
                <h5>üìÖ –î–∞—Ç–∞: ${selectedDate}</h5>
                <h5>üìä –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω—å: ${dateOrders.length}</h5>

                <div style="margin: 20px 0;">
                    <h5>üçΩÔ∏è –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏ –ø–æ—Ä—Ü—ñ–π:</h5>
                    <table style="width: 100%;">
                        <thead>
                            <tr style="background: #ecf0f1;">
                                <th style="padding: 10px;">–ü—Ä–∏–π–æ–º —ó–∂—ñ</th>
                                <th style="padding: 10px;">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—Ä—Ü—ñ–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px;">üåÖ –°–Ω—ñ–¥–∞–Ω–æ–∫</td>
                                <td style="padding: 10px; font-weight: bold;">${mealRequirements.breakfast}</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px;">üçΩÔ∏è –û–±—ñ–¥</td>
                                <td style="padding: 10px; font-weight: bold;">${mealRequirements.lunch}</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px;">üåô –í–µ—á–µ—Ä—è</td>
                                <td style="padding: 10px; font-weight: bold;">${mealRequirements.dinner}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr style="background: #ecf0f1; font-weight: bold;">
                                <td style="padding: 10px;">–í–°–¨–û–ì–û –ü–û–†–¶–Ü–ô:</td>
                                <td style="padding: 10px;">${mealRequirements.breakfast + mealRequirements.lunch + mealRequirements.dinner}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div style="margin: 20px 0;">
                    <h5>üè• –†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö:</h5>
                    <table style="width: 100%;">
                        <thead>
                            <tr style="background: #ecf0f1;">
                                <th style="padding: 10px;">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</th>
                                <th style="padding: 10px;">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                                <th style="padding: 10px;">–ü–æ–≤–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</th>
                                <th style="padding: 10px;">–ß–∞—Å—Ç–∫–æ–≤–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(departmentSummary)
                                .map(([dept, stats]) => `
                                    <tr>
                                        <td style="padding: 10px;">${dept}</td>
                                        <td style="padding: 10px;">${stats.orders}</td>
                                        <td style="padding: 10px;">${stats.fullMeals}</td>
                                        <td style="padding: 10px;">${stats.partialMeals}</td>
                                    </tr>
                                `).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }

        function printKitchenOrder() {
            const dateInput = document.getElementById('kitchen-date');
            const selectedDate = dateInput ? dateInput.value : new Date().toISOString().split('T')[0];

            const printWindow = window.open('', '', 'width=800,height=600');
            const dateOrders = orders.filter(o => o.orderDate === selectedDate);

            const mealRequirements = {
                breakfast: 0,
                lunch: 0,
                dinner: 0
            };

            dateOrders.forEach(order => {
                 const days = parseInt(order.daysCount) || 1;
                if (order.mealOption === 'full') {
                    mealRequirements.breakfast += days;
                    mealRequirements.lunch += days;
                    mealRequirements.dinner += days;
                } else {
                    mealRequirements.lunch += days;
                    mealRequirements.dinner += days;
                }
            });

            printWindow.document.write(`
                <html>
                <head>
                    <title>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –∫—É—Ö–Ω—ñ - ${selectedDate}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #000; padding: 10px; text-align: left; }
                        th { background: #f0f0f0; }
                        .total { font-weight: bold; background: #f0f0f0; }
                    </style>
                </head>
                <body>
                    <h1>üç≥ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –∫—É—Ö–Ω—ñ</h1>
                    <h2>–î–∞—Ç–∞: ${selectedDate}</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>–ü—Ä–∏–π–æ–º —ó–∂—ñ</th>
                                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—Ä—Ü—ñ–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>üåÖ –°–Ω—ñ–¥–∞–Ω–æ–∫</td>
                                <td>${mealRequirements.breakfast}</td>
                            </tr>
                            <tr>
                                <td>üçΩÔ∏è –û–±—ñ–¥</td>
                                <td>${mealRequirements.lunch}</td>
                            </tr>
                            <tr>
                                <td>üåô –í–µ—á–µ—Ä—è</td>
                                <td>${mealRequirements.dinner}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total">
                                <td>–í–°–¨–û–ì–û –ü–û–†–¶–Ü–ô:</td>
                                <td>${mealRequirements.breakfast + mealRequirements.lunch + mealRequirements.dinner}</td>
                            </tr>
                        </tfoot>
                    </table>
                    <p>–ß–∞—Å –¥—Ä—É–∫—É: ${new Date().toLocaleString('uk-UA')}</p>
                </body>
                </html>
            `);

            printWindow.document.close();
            printWindow.print();
        }

        function printWarehouseOrder() {
            const dateInput = document.getElementById('kitchen-date');
            const selectedDate = dateInput ? dateInput.value : new Date().toISOString().split('T')[0];

            const printWindow = window.open('', '', 'width=800,height=600');
            const dateOrders = orders.filter(o => o.orderDate === selectedDate);

            // Calculate total meals needed
            const mealRequirements = {
                breakfast: 0,
                lunch: 0,
                dinner: 0
            };

            dateOrders.forEach(order => {
                 const days = parseInt(order.daysCount) || 1;
                if (order.mealOption === 'full') {
                    mealRequirements.breakfast += days;
                    mealRequirements.lunch += days;
                    mealRequirements.dinner += days;
                } else {
                    mealRequirements.lunch += days;
                    mealRequirements.dinner += days;
                }
            });

            // Calculate ingredients needed (simplified estimation)
            const totalMeals = mealRequirements.breakfast + mealRequirements.lunch + mealRequirements.dinner;
            const ingredients = {
                '–ú\'—è—Å–æ (–∫–≥)': (totalMeals * 0.15).toFixed(1),
                '–û–≤–æ—á—ñ (–∫–≥)': (totalMeals * 0.2).toFixed(1),
                '–ö—Ä—É–ø–∏ (–∫–≥)': (totalMeals * 0.1).toFixed(1),
                '–ú–æ–ª–æ—á–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ (–ª)': (mealRequirements.breakfast * 0.2).toFixed(1),
                '–•–ª—ñ–± (—à—Ç)': Math.ceil(totalMeals * 0.5),
                '–§—Ä—É–∫—Ç–∏ (–∫–≥)': (totalMeals * 0.05).toFixed(1)
            };

            printWindow.document.write(`
                <html>
                <head>
                    <title>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è —Å–∫–ª–∞–¥—É - ${selectedDate}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #000; padding: 10px; text-align: left; }
                        th { background: #f0f0f0; }
                    </style>
                </head>
                <body>
                    <h1>üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è —Å–∫–ª–∞–¥—É</h1>
                    <h2>–î–∞—Ç–∞: ${selectedDate}</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</th>
                                <th>–ù–µ–æ–±—Ö—ñ–¥–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(ingredients)
                                .filter(([_, quantity]) => parseFloat(quantity) > 0)
                                .map(([ingredient, quantity]) => `
                                    <tr>
                                        <td>${ingredient}</td>
                                        <td>${quantity}</td>
                                    </tr>
                                `).join('')}
                        </tbody>
                    </table>
                    <p>–ß–∞—Å –¥—Ä—É–∫—É: ${new Date().toLocaleString('uk-UA')}</p>
                </body>
                </html>
            `);

            printWindow.document.close();
            printWindow.print();
        }

        // Settings functions
        function openDepartmentEditor() {
            const modal = document.getElementById('departmentModal');
            const list = document.getElementById('departments-list');

            if (!modal || !list) return;

            list.innerHTML = '';
            departments.forEach((dept, index) => {
                list.innerHTML += `
                    <div class="menu-editor-item">
                        <input type="text" value="${dept.name}" id="dept-name-${index}" placeholder="–ù–∞–∑–≤–∞ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è">
                        <button onclick="removeDepartment(${index})">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </div>
                `;
            });

            modal.style.display = 'block';
        }

        function closeDepartmentEditor() {
            document.getElementById('departmentModal').style.display = 'none';
        }

        function addNewDepartment() {
            const list = document.getElementById('departments-list');
            const newIndex = departments.length;

            const newItem = document.createElement('div');
            newItem.className = 'menu-editor-item';
            newItem.innerHTML = `
                <input type="text" id="dept-name-${newIndex}" placeholder="–ù–∞–∑–≤–∞ –Ω–æ–≤–æ–≥–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è">
                <button onclick="removeDepartment(${newIndex})">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
            `;

            list.appendChild(newItem);
            departments.push({ id: `dept-${Date.now()}`, name: '' });
        }

        function removeDepartment(index) {
            departments.splice(index, 1);
            openDepartmentEditor();
        }

        function saveDepartments() {
            departments.forEach((dept, index) => {
                const nameInput = document.getElementById(`dept-name-${index}`);
                if (nameInput) {
                    dept.name = nameInput.value;
                }
            });

            departments = departments.filter(dept => dept.name.trim() !== '');
            saveData();
            updateDepartmentSelects();
            closeDepartmentEditor();
            alert('–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
        }

        function openWeeklyMenuEditor() {
            const modal = document.getElementById('weeklyMenuModal');
            if (!modal) return;

            // Find the first day button and click it to initialize
            const firstDayButton = document.querySelector('.day-selector .day-btn');
            if (firstDayButton) {
                selectDay('monday', { target: firstDayButton });
            }
            modal.style.display = 'block';
        }

        function closeWeeklyMenuEditor() {
            document.getElementById('weeklyMenuModal').style.display = 'none';
        }

        function selectDay(day, event) {
            currentEditDay = day;

            // Update day buttons
            document.querySelectorAll('.day-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if(event && event.target) {
                event.target.classList.add('active');
            }


            // Update day editor
            const editor = document.getElementById('day-menu-editor');
            const dayData = weeklyMenu[day];

            const dayNames = {
                monday: '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫',
                tuesday: '–í—ñ–≤—Ç–æ—Ä–æ–∫',
                wednesday: '–°–µ—Ä–µ–¥–∞',
                thursday: '–ß–µ—Ç–≤–µ—Ä',
                friday: '–ü\'—è—Ç–Ω–∏—Ü—è',
                saturday: '–°—É–±–æ—Ç–∞',
                sunday: '–ù–µ–¥—ñ–ª—è'
            };

            editor.innerHTML = `
                <div class="menu-editor-item">
                    <h4>${dayNames[day]}</h4>

                    <div style="margin: 15px 0;">
                        <h5>üåÖ –°–Ω—ñ–¥–∞–Ω–æ–∫</h5>
                        <div class="meal-editor" id="editor-breakfast">
                            ${dayData.breakfast.map((item, i) => `
                                <input type="text" value="${item}" id="breakfast-${i}" placeholder="–°—Ç—Ä–∞–≤–∞ —Å–Ω—ñ–¥–∞–Ω–∫—É">
                            `).join('')}
                        </div>
                        <button onclick="addMealItem('breakfast')" style="margin: 5px 0; padding: 5px 10px; background: #27ae60; color: white; border: none; border-radius: 5px;">‚ûï –î–æ–¥–∞—Ç–∏ —Å—Ç—Ä–∞–≤—É</button>
                    </div>

                    <div style="margin: 15px 0;">
                        <h5>üçΩÔ∏è –û–±—ñ–¥</h5>
                        <div class="meal-editor" id="editor-lunch">
                            ${dayData.lunch.map((item, i) => `
                                <input type="text" value="${item}" id="lunch-${i}" placeholder="–°—Ç—Ä–∞–≤–∞ –æ–±—ñ–¥—É">
                            `).join('')}
                        </div>
                        <button onclick="addMealItem('lunch')" style="margin: 5px 0; padding: 5px 10px; background: #27ae60; color: white; border: none; border-radius: 5px;">‚ûï –î–æ–¥–∞—Ç–∏ —Å—Ç—Ä–∞–≤—É</button>
                    </div>

                    <div style="margin: 15px 0;">
                        <h5>üåô –í–µ—á–µ—Ä—è</h5>
                        <div class="meal-editor" id="editor-dinner">
                            ${dayData.dinner.map((item, i) => `
                                <input type="text" value="${item}" id="dinner-${i}" placeholder="–°—Ç—Ä–∞–≤–∞ –≤–µ—á–µ—Ä—ñ">
                            `).join('')}
                        </div>
                        <button onclick="addMealItem('dinner')" style="margin: 5px 0; padding: 5px 10px; background: #27ae60; color: white; border: none; border-radius: 5px;">‚ûï –î–æ–¥–∞—Ç–∏ —Å—Ç—Ä–∞–≤—É</button>
                    </div>
                </div>
            `;
        }

        function addMealItem(mealType) {
            const mealEditor = document.getElementById(`editor-${mealType}`);
            const currentItems = weeklyMenu[currentEditDay][mealType];
            const newIndex = currentItems.length;

            const input = document.createElement('input');
            input.type = 'text';
            input.id = `${mealType}-${newIndex}`;
            input.placeholder = `–ù–æ–≤–∞ —Å—Ç—Ä–∞–≤–∞ –¥–ª—è ${mealType === 'breakfast' ? '—Å–Ω—ñ–¥–∞–Ω–∫—É' : mealType === 'lunch' ? '–æ–±—ñ–¥—É' : '–≤–µ—á–µ—Ä—ñ'}`;

            mealEditor.appendChild(input);
            weeklyMenu[currentEditDay][mealType].push('');
        }

        function saveWeeklyMenu() {
            // Save current day data
            const dayData = weeklyMenu[currentEditDay];

            ['breakfast', 'lunch', 'dinner'].forEach(mealType => {
                const inputs = document.querySelectorAll(`input[id^="${mealType}-"]`);
                const items = [];
                inputs.forEach(input => {
                    if (input.value.trim()) {
                        items.push(input.value.trim());
                    }
                });
                dayData[mealType] = items;
            });

            saveData();
            renderWeeklyMenu();
            closeWeeklyMenuEditor();
            alert('–¢–∏–∂–Ω–µ–≤–µ –º–µ–Ω—é —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
        }

        function openDietEditor() {
            const modal = document.getElementById('dietModal');
            const list = document.getElementById('diets-list');

            if (!modal || !list) return;

            list.innerHTML = '';
            diets.forEach((diet, index) => {
                list.innerHTML += `
                    <div class="menu-editor-item">
                        <input type="text" value="${diet.name}" id="diet-name-${index}" placeholder="–ù–∞–∑–≤–∞ –¥—ñ—î—Ç–∏">
                        <button onclick="removeDiet(${index})">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </div>
                `;
            });

            modal.style.display = 'block';
        }

        function closeDietEditor() {
            document.getElementById('dietModal').style.display = 'none';
        }

        function addNewDiet() {
            const list = document.getElementById('diets-list');
            const newIndex = diets.length;

            const newItem = document.createElement('div');
            newItem.className = 'menu-editor-item';
            newItem.innerHTML = `
                <input type="text" id="diet-name-${newIndex}" placeholder="–ù–∞–∑–≤–∞ –Ω–æ–≤–æ—ó –¥—ñ—î—Ç–∏">
                <button onclick="removeDiet(${newIndex})">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
            `;

            list.appendChild(newItem);
            diets.push({ id: `diet-${Date.now()}`, name: '' });
        }

        function removeDiet(index) {
            diets.splice(index, 1);
            openDietEditor();
        }

        function saveDiets() {
            diets.forEach((diet, index) => {
                const nameInput = document.getElementById(`diet-name-${index}`);
                if (nameInput) {
                    diet.name = nameInput.value;
                }
            });

            diets = diets.filter(diet => diet.name.trim() !== '');
            saveData();
            updateDietSelects();
            closeDietEditor();
            alert('–¢–∏–ø–∏ –¥—ñ—î—Ç —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
        }

        function updateDietSelects() {
            const patientDietSelect = document.getElementById('patient-diet-type');
            const employeeDietSelect = document.getElementById('employee-diet-type');

            const dietOptions = diets.map(diet =>
                `<option value="${diet.id}">${diet.name}</option>`
            ).join('');

            if (patientDietSelect) {
                patientDietSelect.innerHTML = dietOptions;
            }
            if (employeeDietSelect) {
                employeeDietSelect.innerHTML = dietOptions;
            }
        }

        // Export functions
        function prepareExportData() {
            const fromDate = document.getElementById('export-date-from').value;
            const toDate = document.getElementById('export-date-to').value;
            const format = document.getElementById('export-format').value;

            let filteredOrders = orders;

            if (fromDate) {
                filteredOrders = filteredOrders.filter(o => o.orderDate >= fromDate);
            }
            if (toDate) {
                filteredOrders = filteredOrders.filter(o => o.orderDate <= toDate);
            }

            let exportData = '';

            if (format === 'json') {
                exportData = JSON.stringify(filteredOrders, null, 2);
            } else if (format === 'xml') {
                exportData = '<?xml version="1.0" encoding="UTF-8"?>\n<orders>\n';
                filteredOrders.forEach(order => {
                    exportData += '  <order>\n';
                    exportData += `    <id>${order.id}</id>\n`;
                    exportData += `    <type>${order.type}</type>\n`;
                    exportData += `    <date>${order.orderDate}</date>\n`;
                    exportData += `    <amount>${order.amount}</amount>\n`;
                    exportData += `    <mealOption>${order.mealOption}</mealOption>\n`;
                    exportData += `    <status>${order.status}</status>\n`;
                    exportData += '  </order>\n';
                });
                exportData += '</orders>';
            } else if (format === 'csv') {
                exportData = 'ID,–î–∞—Ç–∞,–¢–∏–ø,–ó–∞–º–æ–≤–Ω–∏–∫,–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è,–¢–∏–ø —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è,–°—É–º–∞,–°—Ç–∞—Ç—É—Å\n';
                filteredOrders.forEach(order => {
                    const customer = order.type === 'patient' ? order.patientName : order.employeeName;
                    const deptId = order.type === 'patient' ? order.department : order.employeeDepartment;
                    const deptName = departments.find(d => d.id === deptId)?.name || deptId;
                    const mealType = order.mealOption === 'full' ? '–ü–æ–≤–Ω–µ' : '–ß–∞—Å—Ç–∫–æ–≤–µ';
                    exportData += `${order.id},${order.orderDate},${order.type},"${customer}","${deptName}",${mealType},${order.amount},${order.status}\n`;
                });
            }

            document.getElementById('export-data').value = exportData;
        }

        function exportToAPI() {
            const exportData = document.getElementById('export-data').value;

            if (!exportData) {
                alert('–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–≥–æ—Ç—É–π—Ç–µ –¥–∞–Ω—ñ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É');
                prepareExportData();
                return;
            }

            // Simulate API call
            alert('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ –Ü–° –ü–†–û —á–µ—Ä–µ–∑ API!\n\n–ï–Ω–¥–ø–æ—ñ–Ω—Ç: https://api.ispro.ua/v1/orders\n–ú–µ—Ç–æ–¥: POST\n–°—Ç–∞—Ç—É—Å: 200 OK');
        }

        function downloadExport() {
            const exportData = document.getElementById('export-data').value;
            const format = document.getElementById('export-format').value;

            if (!exportData) {
                alert('–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–≥–æ—Ç—É–π—Ç–µ –¥–∞–Ω—ñ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É');
                prepareExportData();
                return;
            }

            let mimeType = 'text/plain';
            let extension = 'txt';

            if (format === 'json') {
                mimeType = 'application/json';
                extension = 'json';
            } else if (format === 'xml') {
                mimeType = 'application/xml';
                extension = 'xml';
            } else if (format === 'csv') {
                mimeType = 'text/csv';
                extension = 'csv';
            }

            const blob = new Blob([exportData], { type: `${mimeType};charset=utf-8;` });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hospital_orders_${new Date().toISOString().split('T')[0]}.${extension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function showOrderDetails(orderId) {
            const order = orders.find(o => o.id == orderId);
            if (!order) return;

            const mealTypeText = order.mealOption === 'full' ? '–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–µ —Ç—Ä–∏–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è' : '–ß–∞—Å—Ç–∏–Ω–Ω–µ –¥–≤–æ–¥—ñ–ª—å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è';
            const departmentName = departments.find(d => d.id === order.department)?.name || order.department;
            const dietName = diets.find(d => d.id === order.dietType)?.name || order.dietType;

            const details = `
–î–ï–¢–ê–õ–Ü –ó–ê–ú–û–í–õ–ï–ù–ù–Ø #${order.id}

–¢–∏–ø: ${order.type === 'patient' ? '–ü–∞—Ü—ñ—î–Ω—Ç' : '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫'}
${order.type === 'patient' ?
    `–ü–∞—Ü—ñ—î–Ω—Ç: ${order.patientName}
–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è: ${departmentName}
–ü–∞–ª–∞—Ç–∞: ${order.room}` :
    `–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫: ${order.employeeName}
–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è: ${order.employeeDepartment}`
}
–î–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${order.orderDate}
–¢–∏–ø –¥—ñ—î—Ç–∏: ${dietName}
–¢–∏–ø —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è: ${mealTypeText}
–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤: ${order.daysCount}

–ó–ê–ì–ê–õ–¨–ù–ê –°–£–ú–ê: ${order.amount} –≥—Ä–Ω
–°–¢–ê–¢–£–°: ${order.status}
–°–¢–í–û–†–ï–ù–û: ${order.createdAt}
            `;

            alert(details);
        }

        // Employee management functions
        function updateEmployeesTable() {
            const tableBody = document.getElementById('employees-table');
            if (!tableBody) return;

            if (Object.keys(employees).length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            –ù–µ–º–∞—î —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            Object.entries(employees).forEach(([phone, emp]) => {
                const fullName = `${emp.lastName} ${emp.firstName} ${emp.patronymic}`;
                const roleText = {
                    'admin': '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä',
                    'doctor': '–õ—ñ–∫–∞—Ä',
                    'nurse': '–ú–µ–¥—Å–µ—Å—Ç—Ä–∞',
                    'employee': '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫'
                }[emp.role] || emp.role;

                tableHTML += `
                    <tr>
                        <td>${fullName}</td>
                        <td>${phone}</td>
                        <td>${emp.department}</td>
                        <td>${emp.position}</td>
                        <td>
                            <span style="padding: 3px 8px; border-radius: 10px; font-size: 12px; font-weight: bold;
                                ${emp.role === 'admin' ? 'background: rgba(231,76,60,0.2); color: #e74c3c' :
                                  emp.role === 'doctor' ? 'background: rgba(52,152,219,0.2); color: #3498db' :
                                  emp.role === 'nurse' ? 'background: rgba(46,204,113,0.2); color: #27ae60' :
                                  'background: rgba(149,165,166,0.2); color: #95a5a6'}">
                                ${roleText}
                            </span>
                        </td>
                        <td>
                            <button onclick="editEmployee('${phone}')" style="background: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-right: 5px;">
                                ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </button>
                            <button onclick="deleteEmployeeConfirm('${phone}')" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openEmployeeEditor() {
            currentEditEmployeePhone = null;
            document.getElementById('employee-modal-title').textContent = 'üë• –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞';
            document.getElementById('delete-employee-btn').style.display = 'none';

            // Clear form
            document.getElementById('employee-form').reset();

            // Update department options
            updateEmployeeDepartmentSelect();

            document.getElementById('employeeModal').style.display = 'block';
        }

        function editEmployee(phone) {
            currentEditEmployeePhone = phone;
            const emp = employees[phone];

            document.getElementById('employee-modal-title').textContent = 'üë• –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞';
            document.getElementById('delete-employee-btn').style.display = 'inline-block';

            // Fill form with employee data
            document.getElementById('emp-firstname').value = emp.firstName;
            document.getElementById('emp-lastname').value = emp.lastName;
            document.getElementById('emp-patronymic').value = emp.patronymic;
            document.getElementById('emp-phone').value = phone;
            document.getElementById('emp-password').value = emp.password;
            document.getElementById('emp-department').value = emp.department;
            document.getElementById('emp-position').value = emp.position;
            document.getElementById('emp-role').value = emp.role;

            // Update department options
            updateEmployeeDepartmentSelect();

            document.getElementById('employeeModal').style.display = 'block';
        }

        function closeEmployeeEditor() {
            document.getElementById('employeeModal').style.display = 'none';
            currentEditEmployeePhone = null;
        }

        function updateEmployeeDepartmentSelect() {
            const select = document.getElementById('emp-department');
            if (!select) return;

            select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>';
            departments.forEach(dept => {
                select.innerHTML += `<option value="${dept.name}">${dept.name}</option>`;
            });

            // Add Administration if not exists
            if (!departments.find(d => d.name === '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è')) {
                select.innerHTML += '<option value="–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è</option>';
            }
        }

        function saveEmployee() {
            const firstName = document.getElementById('emp-firstname').value.trim();
            const lastName = document.getElementById('emp-lastname').value.trim();
            const patronymic = document.getElementById('emp-patronymic').value.trim();
            const phone = document.getElementById('emp-phone').value.trim();
            const password = document.getElementById('emp-password').value.trim();
            const department = document.getElementById('emp-department').value;
            const position = document.getElementById('emp-position').value.trim();
            const role = document.getElementById('emp-role').value;

            // Validation
            if (!firstName || !lastName || !phone || !password || !department || !position) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è');
                return;
            }

            // Check phone format
            if (!/^\+380\d{9}$/.test(phone)) {
                alert('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É –º–∞—î –±—É—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ +380XXXXXXXXX');
                return;
            }

            // Check if phone already exists (for new employees or changed phone)
            if ((!currentEditEmployeePhone || phone !== currentEditEmployeePhone) && employees[phone]) {
                alert('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫ –∑ —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É –≤–∂–µ —ñ—Å–Ω—É—î');
                return;
            }

            // Create/update employee
            const employeeData = {
                firstName,
                lastName,
                patronymic,
                password,
                department,
                position,
                role
            };

            if (currentEditEmployeePhone && phone !== currentEditEmployeePhone) {
                // Phone changed - delete old entry and create new
                delete employees[currentEditEmployeePhone];
            }

            employees[phone] = employeeData;
            saveData();
            updateEmployeesTable();
            closeEmployeeEditor();

            const action = currentEditEmployeePhone ? '–æ–Ω–æ–≤–ª–µ–Ω–æ' : '–¥–æ–¥–∞–Ω–æ';
            alert(`–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ —É—Å–ø—ñ—à–Ω–æ ${action}!`);
        }

        function deleteEmployee() {
            if (!currentEditEmployeePhone) return;

            const emp = employees[currentEditEmployeePhone];
            const fullName = `${emp.lastName} ${emp.firstName} ${emp.patronymic}`;

            if (confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ ${fullName}?`)) {
                delete employees[currentEditEmployeePhone];
                saveData();
                updateEmployeesTable();
                closeEmployeeEditor();
                alert('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }
        }

        function deleteEmployeeConfirm(phone) {
            const emp = employees[phone];
            const fullName = `${emp.lastName} ${emp.firstName} ${emp.patronymic}`;

            if (confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ ${fullName}?`)) {
                delete employees[phone];
                saveData();
                updateEmployeesTable();
                alert('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }
        }

        function filterByDepartment() {
            const filter = document.getElementById('department-filter').value;
            updateDepartmentStats(); // This function will now need to handle filtering, or you can implement filtering logic here
        }

        // Window click event to close modals
        window.onclick = function(event) {
            const loginModal = document.getElementById('loginModal');
            const deptModal = document.getElementById('departmentModal');
            const weeklyMenuModal = document.getElementById('weeklyMenuModal');
            const dietModal = document.getElementById('dietModal');
            const employeeModal = document.getElementById('employeeModal');

            if (event.target == loginModal) {
                closeLoginModal();
            }
            if (event.target == deptModal) {
                closeDepartmentEditor();
            }
            if (event.target == weeklyMenuModal) {
                closeWeeklyMenuEditor();
            }
            if (event.target == dietModal) {
                closeDietEditor();
            }
            if (event.target == employeeModal) {
                closeEmployeeEditor();
            }
        }

        // Initialize when page loads
        window.onload = function() {
            init();

            // Add event listeners after DOM is loaded
            setTimeout(() => {
                const patientDaysInput = document.getElementById('patient-days-count');
                const employeeDaysInput = document.getElementById('employee-days-count');
                const employeeOrderDateInput = document.getElementById('employee-order-date');

                if (patientDaysInput) {
                    patientDaysInput.addEventListener('input', updateOrderSummary);
                }
                if (employeeDaysInput) {
                    employeeDaysInput.addEventListener('input', updateEmployeeOrderSummary);
                }
                // Add event listener to re-check time restrictions when date changes
                if (employeeOrderDateInput) {
                    employeeOrderDateInput.addEventListener('change', checkTimeRestrictions);
                }

                // Set default export dates
                const today = new Date().toISOString().split('T')[0];
                const exportDateFrom = document.getElementById('export-date-from');
                const exportDateTo = document.getElementById('export-date-to');
                const kitchenDate = document.getElementById('kitchen-date');

                if (exportDateFrom) exportDateFrom.value = today;
                if (exportDateTo) exportDateTo.value = today;
                if (kitchenDate) {
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    kitchenDate.value = tomorrow.toISOString().split('T')[0];
                }
            }, 100);
        };
    
function togglePassword(inputId, btn) {
    const input = document.getElementById(inputId);
    if (input.type === "password") {
        input.type = "text";
        btn.textContent = "üôà";
    } else {
        input.type = "password";
        btn.textContent = "üëÅ";
    }
}

</script>
  </body>
</html>